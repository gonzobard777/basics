1. фаза **Компиляция кода**. Компилятор находит и связывает все объявления с соответствующими областями видимости (сначала объявления функций, затем `var` переменных). При этом происходит поднятие объявлений (hoisting).
2. фаза **Исполнение кода**

## Область видимости

**Блочная область видимости** – это принадлежность переменных и функций произвольному блоку `{..}`. Переменные должны быть объявлены через `let` или `const`.

**Лексической областью видимости** называется область видимости, определяемая на стадии лексического анализа. Другими словами, она определяется тем, где вы разместили переменные, функции и блоки видимости во время написания программы.

![Lexical scope](./data/lexical-scope.png)

В этом примере существуют три области видимости:

- Область (1) охватывает глобальную область видимости и содержит всего один идентификатор: `foo`.
- Область (2) охватывает область видимости `foo` и содержит три идентификатора: `a`, `bar` и `b`.
- Область (3) охватывает область видимости `bar` и включает один идентификатор: `c`.

Область видимости `bar` полностью содержится внутри области видимости `foo`, потому что (и только по этой причине) мы решили определить функцию `bar` именно здесь.  
Неважно, _где_ вызывается функция, и даже _как_ она вызывается – **лексическая область видимости функции** определяется только тем, в каком месте программы эта функция была объявлена.

Так в нашем примере лексической областью видимости функции `bar` являются область (3) + область (2), а в зависимости от релизации движка, то может быть еще и + область (1).  
Когда движек выполняет команду `console.log(a, b, c)`, то поиск идентификаторов в областях видимости идет в таком порядке: в (3) находит `c` ➜ в (2) находит `a` и `b`.

## Замыкания

**Замыкание** – это способность функции запоминать свою лексическую область видимости и обращаться к ней, даже когда функция вызывается за пределами своей лексической области видимости.

### Checks

```js
a = 2;
var a;
console.log(a); // ?
```

```js
console.log(a); // ?
var a = 2;
```

```js
if (true) {
  console.log(foo);
  const foo = 123;
}
```

```js
for (let i = 1; i <= 5; i++) { // и вариант: var i = 1 
  const timerId = setTimeout(() => {
    console.log(i);
  }, i * 1000);
}
```
